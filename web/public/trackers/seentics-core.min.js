!function(e,t){"use strict";if(!e.SEENTICS_CORE){var n={apiHost:"localhost"===e.location.hostname||"127.0.0.1"===e.location.hostname||e.location.hostname.endsWith(".local")?"http://localhost:8080":"https://api.seentics.com",websiteId:null,debug:!1,autoLoad:{analytics:!0,automation:!0,funnels:!0,heatmap:!0,replay:!0}},i={visitorId:null,sessionId:null,pageViewId:null,sessionStart:null,lastActivity:Date.now(),eventQueue:[],isProcessing:!1,retryCount:0,retryDelay:1e3,maxRetryDelay:6e4},o={},a=function(e,t){(o[e]||[]).forEach(function(e){e(t)})},s=function(){n.debug&&console.log.apply(console,["[Seentics]"].concat(Array.prototype.slice.call(arguments)))},r={generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},getCookie:function(e){var n=("; "+t.cookie).split("; "+e+"=");return 2===n.length?n.pop().split(";").shift():null},setCookie:function(e,n,i){t.cookie=e+"="+n+"; expires="+new Date(Date.now()+864e5*i).toUTCString()+"; path=/; SameSite=Lax"},getSessionCookie:function(e){return sessionStorage.getItem(e)},setSessionCookie:function(e,t){sessionStorage.setItem(e,t)},debounce:function(e,t){var n;return function(){var i=arguments,o=this;clearTimeout(n),n=setTimeout(function(){e.apply(o,i)},t)}}},c={init:function(){i.visitorId=r.getCookie("seentics_vid"),i.visitorId||(i.visitorId=r.generateId(),r.setCookie("seentics_vid",i.visitorId,365)),i.sessionId=r.getSessionCookie("seentics_sid");var e=r.getSessionCookie("seentics_last_activity"),t=Date.now();(!i.sessionId||!e||t-parseInt(e)>18e5)&&(i.sessionId=r.generateId(),i.sessionStart=t,r.setSessionCookie("seentics_sid",i.sessionId),a("session:start",{sessionId:i.sessionId})),r.setSessionCookie("seentics_last_activity",t.toString()),i.lastActivity=t},updateActivity:function(){var e=Date.now();i.lastActivity=e,r.setSessionCookie("seentics_last_activity",e.toString())}},u={send:function(e,t){return s("POST",e),fetch(n.apiHost+"/api/v1/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){if(!e.ok)throw new Error("API error: "+e.status);return e.json()})},get:function(e,t){var i=new URL(n.apiHost+"/api/v1/"+e);return t&&Object.keys(t).forEach(function(e){i.searchParams.append(e,t[e])}),fetch(i.toString(),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){if(!e.ok)throw new Error("API error: "+e.status);return e.json()})},batch:function(t){return u.send("analytics/batch",{siteId:n.websiteId,domain:e.location.hostname,events:t})}},l={add:function(e){i.eventQueue.push(Object.assign({visitor_id:i.visitorId,session_id:i.sessionId,timestamp:(new Date).toISOString()},e)),i.eventQueue.length>=10&&l.flush()},flush:function(){if(i.isProcessing||0===i.eventQueue.length)return Promise.resolve();i.isProcessing=!0;var e=i.eventQueue.slice();return i.eventQueue=[],u.batch(e).then(function(){a("queue:flushed",{count:e.length}),i.retryCount=0,i.retryDelay=1e3;try{localStorage.removeItem("seentics_failed_events")}catch(e){}}).catch(function(t){i.eventQueue=e.concat(i.eventQueue);try{var n=JSON.parse(localStorage.getItem("seentics_failed_events")||"[]");localStorage.setItem("seentics_failed_events",JSON.stringify(n.concat(e).slice(-100)))}catch(e){}i.retryCount++,i.retryDelay=Math.min(2*i.retryDelay,i.maxRetryDelay),s("Retry #"+i.retryCount+", next in "+i.retryDelay+"ms"),setTimeout(l.flush,i.retryDelay),a("queue:error",{error:t,retryCount:i.retryCount})}).finally(function(){i.isProcessing=!1})},restore:function(){try{var e=JSON.parse(localStorage.getItem("seentics_failed_events")||"[]");e.length>0&&(i.eventQueue=e.concat(i.eventQueue),s("Restored",e.length,"failed events"))}catch(e){}}},d={isReady:!1},f=function(o){return Object.assign(n,o||{}),n.websiteId?(s("Loading remote config..."),u.get("tracker/config/"+n.websiteId).then(function(e){var t=e&&e.data?e.data:e;t&&(n.dynamicConfig=t,Object.assign(n,t),void 0!==t.automation_enabled&&(n.autoLoad.automation=!!t.automation_enabled),void 0!==t.funnel_enabled&&(n.autoLoad.funnels=!!t.funnel_enabled),void 0!==t.heatmap_enabled&&(n.autoLoad.heatmap=!!t.heatmap_enabled),void 0!==t.replay_enabled&&(n.autoLoad.replay=!!t.replay_enabled),s("Modules:",n.autoLoad))}).catch(function(e){console.warn("[Seentics] Failed to load remote config.",e)})).then(function(){c.init(),l.restore(),e.addEventListener("beforeunload",function(){i.eventQueue.length>0&&(navigator.sendBeacon(n.apiHost+"/api/v1/analytics/batch",new Blob([JSON.stringify({siteId:n.websiteId,domain:e.location.hostname,events:i.eventQueue})],{type:"application/json"})),i.eventQueue=[])}),setInterval(function(){i.eventQueue.length>0&&l.flush()},3e4),t.addEventListener("visibilitychange",function(){"hidden"===t.visibilityState&&i.eventQueue.length>0&&l.flush()}),["click","scroll","mousemove","keydown"].forEach(function(e){t.addEventListener(e,r.debounce(c.updateActivity,1e3),{passive:!0})}),d.isReady=!0,a("core:ready",{config:n,state:i})}):(console.error("[Seentics] Website ID is required"),Promise.resolve())};e.SEENTICS_CORE={version:"2.0",init:f,config:n,state:i,utils:r,session:c,api:u,queue:l,page:{getCurrentPage:function(){return{url:e.location.href,path:e.location.pathname,title:t.title,referrer:t.referrer,screen:{width:e.screen.width,height:e.screen.height},viewport:{width:e.innerWidth,height:e.innerHeight}}}},track:function(t,n){e.seentics&&e.seentics.analytics&&e.seentics.analytics.track?e.seentics.analytics.track(t,n||{}):l.add({event_type:t,page_url:e.location.href,page:e.location.pathname,properties:n||{}}),a("analytics:event",{eventName:t,properties:n||{}})},on:function(e,t){(o[e]=o[e]||[]).push(t)},emit:a,off:function(e,t){o[e]&&(o[e]=o[e].filter(function(e){return e!==t}))},isReady:function(){return d.isReady}};var h=t.currentScript;if(h){var p=h.getAttribute("data-website-id")||h.getAttribute("data-site-id"),v="true"===h.getAttribute("data-debug"),y=h.getAttribute("data-api-host"),g=h.getAttribute("data-auto-load"),m=null;try{m=new URL(h.src).origin}catch(e){}if(g){var b=g.split(",").map(function(e){return e.trim()});n.autoLoad={analytics:b.includes("analytics"),automation:b.includes("automation"),funnels:b.includes("funnels"),heatmap:b.includes("heatmap"),replay:b.includes("replay")}}p&&f({websiteId:p,debug:v,apiHost:y||m||n.apiHost}).then(function(){var e=h.src.substring(0,h.src.lastIndexOf("/")+1),i=h.src.includes(".min.js"),o=function(n){var o=t.createElement("script");o.src=e+"seentics-"+n+(i?".min.js":".js")+"?t="+Date.now(),o.async=!0,o.onerror=function(){s("Failed to load",n)},t.head.appendChild(o)};n.autoLoad.analytics&&o("analytics"),n.autoLoad.automation&&o("automation"),n.autoLoad.funnels&&o("funnels"),n.autoLoad.heatmap&&o("heatmap"),n.autoLoad.replay&&o("replay")})}}}(window,document);