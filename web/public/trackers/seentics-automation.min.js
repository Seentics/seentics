!function(e,t){"use strict";var i=e.SEENTICS_CORE;if(i){var n={activeAutomations:[],executedAutomations:new Set,sessionExecutions:new Set,initialized:!1,buffer:[]},o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i,a=function(e,t,i){switch(t){case"eq":return e==i;case"neq":return e!=i;case"contains":return String(e).includes(i);case"gt":return Number(e)>Number(i);case"lt":return Number(e)<Number(i);default:return!0}},r=function(n,a){return n&&"string"==typeof n?n.replace(/\{\{([^}]+)\}\}/g,function(n,r){var s=r.trim(),c=Object.assign({user_id:i.state.userId||i.state.visitorId||"anonymous",user_email:i.state.userEmail||"",user_name:i.state.userName||"",user_language:navigator.language||"",user_timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||"",session_id:i.state.sessionId||"",page_views:i.state.pageViews||1,referrer:t.referrer||"",page_url:e.location.href,page_title:t.title,page_path:e.location.pathname,device_type:o.test(navigator.userAgent)?"mobile":"desktop",screen_width:e.screen.width,screen_height:e.screen.height,timestamp:Math.floor(Date.now()/1e3),date:(new Date).toISOString().split("T")[0]},a||{});return void 0!==c[s]?c[s]:n}):n},s=function(s,c){c=c||{},n.activeAutomations.forEach(function(l){var p=(l.triggerType||l.trigger_type||"").toLowerCase(),g=l.triggerConfig||l.trigger_config||{},m=!1;if("timeonpage"===p&&"timer"===s)m=c.seconds>=(g.seconds||10);else if("scrolldepth"===p&&"scroll"===s)m=c.depth>=(g.percentage||g.depth||50);else if("exitintent"===p&&"page_exit"===s)m=!0;else if("formsubmit"===p&&"formsubmit"===s)if(g.selector){var b=t.querySelector(g.selector);m=b&&(b.id===c.formId||b.className.includes(c.formClass))}else m=!0;else"inactivity"===p&&"inactivity"===s?m=c.seconds>=(g.seconds||30):"funneldropoff"===p&&"funneldropoff"===s?m=!g.funnel_id||c.funnel_id===g.funnel_id&&(!g.step||c.step===g.step):"funnelcomplete"===p&&"funnelcomplete"===s?m=!g.funnel_id||c.funnel_id===g.funnel_id:"goalcompleted"===p&&"goalcompleted"===s?m=!g.goal_id||c.goal_id===g.goal_id&&(!g.min_value||(c.value||0)>=parseFloat(g.min_value)):p===s.toLowerCase().replace("_","")&&(m=!0);if(m){if(g.url_pattern&&"*"!==g.url_pattern){var v=g.url_pattern,x=e.location.pathname;if(v.includes("*")){if(!new RegExp("^"+v.replace(/\*/g,".*")+"$").test(x))return}else if(x!==v)return}(function(r){var s=r.id,c=r.conditions||[],l=(r.triggerConfig||r.trigger_config||{}).frequency||"every";if("once"===l||"once_per_visitor"===l){if(n.executedAutomations.has(s))return!1}else if("once_per_session"===l){if(n.sessionExecutions.has(s))return!1}else if("once_per_day"===l){var d=localStorage.getItem("seentics_auto_"+s);if(d&&parseInt(d)>Date.now()-864e5)return!1}for(var f=0;f<c.length;f++){var u,p=c[f],g=(p.conditionType||p.type||"").toLowerCase(),m=p.conditionConfig||p.config||{},b=p.operator||m.operator||"eq",v=p.value||m.value;switch(g){case"device":u=o.test(navigator.userAgent)?"mobile":"desktop",v||(v=m.device_type);break;case"visitor":u=i.state.sessionStart===i.state.lastActivity?"new":"returning",v||(v=m.visitor_status);break;case"language":u=navigator.language.substring(0,2).toLowerCase();break;case"url_param":u=new URLSearchParams(e.location.search).get(p.param||m.param||m.param_name);break;case"referrer":u=t.referrer;break;case"page_views":u=i.state.pageViews||1;break;case"traffic_source":var x=t.referrer.toLowerCase();if(x)if(x.includes("google")||x.includes("bing"))u="organic";else if(x.includes("facebook")||x.includes("twitter")||x.includes("linkedin"))u="social";else{var y=new URLSearchParams(e.location.search);u="cpc"===y.get("utm_medium")||y.get("gclid")?"paid":"referral"}else u="direct";break;case"cookie":if(u=i.utils.getCookie(p.cookie_name||m.cookie_name),"exists"===b)return null!==u;if("not_exists"===b)return null===u}if(!a(u,b,v))return!1}return!0})(l)&&(i.config.debug&&console.log("[Seentics Automation] Triggering:",l.name||l.id),function(o,a){var s=o.actions||[];i.track("automation_triggered",{automation_id:o.id,automation_name:o.name,trigger_type:o.triggerType||o.trigger_type,action_count:s.length});var c=0,l=0,p=Promise.resolve();s.forEach(function(n){p=p.then(function(){return function(n,o){var a=function(e,t){var i={};for(var n in e)i[n]="string"==typeof e[n]?r(e[n],t):e[n];return i}(n.actionConfig||n.action_config||{},o),s=(n.actionType||n.action_type||"").toLowerCase();switch(s){case"modal":d(a);break;case"banner":f(a);break;case"notification":u(a);break;case"script":var c=t.createElement("script");c.textContent=a.code||"",("head"===a.position?t.head:t.body).appendChild(c);break;case"redirect":a.url&&setTimeout(function(){a.newTab?e.open(a.url,"_blank"):e.location.href=a.url},1e3*(parseInt(a.delay)||0));break;case"hide_element":case"hideelement":if(a.selector){var l=t.querySelector(a.selector);l&&(l.style.display="none")}break;case"show_element":case"showelement":if(a.selector){var p=t.querySelector(a.selector);p&&(p.style.display=a.display_type||"block")}break;case"track_event":case"trackevent":if(a.event_name){var g=a.properties?JSON.parse(a.properties):{};i.emit("analytics:event",{event:a.event_name,properties:g})}break;case"set_cookie":case"setcookie":a.cookie_name&&a.cookie_value&&i.utils.setCookie(a.cookie_name,a.cookie_value,parseInt(a.expiration_days)||30)}return i.emit("automation:action",{type:s,config:a}),Promise.resolve()}(n,a||{}).then(function(){c++}).catch(function(e){l++,console.error("[Seentics Automation] Action failed:",e),i.track("automation_action_failed",{automation_id:o.id,action_type:n.actionType||n.action_type,error:e.message||"Unknown"})})})}),p.then(function(){i.track("automation_completed",{automation_id:o.id,automation_name:o.name,status:0===l?"success":"partial_failure",success_count:c,failure_count:l,total_actions:s.length}),n.buffer.push({automationId:o.id,websiteId:i.config.websiteId,visitorId:i.state.visitorId,sessionId:i.state.sessionId,status:"success",executionData:a||{},executedAt:(new Date).toISOString()})})}(l,c),function(e){var t=e.id,i=(e.triggerConfig||e.trigger_config||{}).frequency||"every";n.sessionExecutions.add(t),"once"!==i&&"once_per_visitor"!==i||(n.executedAutomations.add(t),localStorage.setItem("seentics_executed_autos",JSON.stringify(Array.from(n.executedAutomations)))),"once_per_day"===i&&localStorage.setItem("seentics_auto_"+t,Date.now().toString())}(l))}})},c=function(){if(0!==n.buffer.length){var e=JSON.stringify({website_id:i.config.websiteId,executions:n.buffer});n.buffer=[],navigator.sendBeacon(i.config.apiHost+"/api/v1/workflows/execution/batch",new Blob([e],{type:"application/json"}))}};setInterval(function(){if(0!==n.buffer.length){var e=n.buffer.slice();n.buffer=[],i.api.send("workflows/execution/batch",{website_id:i.config.websiteId,executions:e}).catch(function(){n.buffer=e.concat(n.buffer)})}},3e4),e.addEventListener("beforeunload",c),t.addEventListener("visibilitychange",function(){"hidden"===t.visibilityState&&c()});var l=function(){if(!t.getElementById("seentics-auto-css")){var e=t.createElement("style");e.id="seentics-auto-css",e.textContent=".seentics-modal-overlay{position:fixed;inset:0;background:rgba(15,23,42,.75);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:2147483647;animation:stFadeIn .4s cubic-bezier(.16,1,.3,1)}.seentics-modal-content{background:#fff;border-radius:20px;max-width:480px;width:90%;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);position:relative;overflow:hidden;animation:stSlideUp .4s cubic-bezier(.16,1,.3,1)}.seentics-modal-close{position:absolute;top:20px;right:20px;background:#f1f5f9;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;color:#64748b;transition:all .2s}.seentics-modal-close:hover{background:#e2e8f0;color:#0f172a}.seentics-modal-body{padding:40px 32px 32px}.seentics-modal-title{margin:0 0 12px;font-size:24px;font-weight:800;color:#0f172a;letter-spacing:-.025em;line-height:1.2}.seentics-modal-text{margin:0 0 32px;font-size:16px;line-height:1.6;color:#475569}.seentics-modal-actions{display:flex;gap:12px;justify-content:flex-end}.seentics-btn-primary,.seentics-btn-secondary{padding:12px 24px;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;border:none;transition:all .2s cubic-bezier(.4,0,.2,1)}.seentics-btn-primary{background:#4f46e5;color:#fff;box-shadow:0 4px 6px -1px rgba(79,70,229,.2)}.seentics-btn-primary:hover{background:#4338ca;transform:translateY(-1px);box-shadow:0 10px 15px -3px rgba(79,70,229,.3)}.seentics-btn-secondary{background:#f8fafc;color:#475569;border:1px solid #e2e8f0}.seentics-btn-secondary:hover{background:#f1f5f9;color:#0f172a}@keyframes stFadeIn{from{opacity:0}to{opacity:1}}@keyframes stSlideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes stSlideDown{from{transform:translateY(-100%)}to{transform:translateY(0)}}@keyframes stSlideUpBanner{from{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes stSlideRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}",t.head.appendChild(e)}},d=function(i){l();var n=t.createElement("div");if(n.className="seentics-modal-root",n.innerHTML=i.customHtml||'<div class="seentics-modal-overlay"><div class="seentics-modal-content"><button class="seentics-modal-close" data-seentics-close aria-label="Close">&times;</button><div class="seentics-modal-body"><h2 class="seentics-modal-title">'+(i.title||"Attention")+'</h2><div class="seentics-modal-text">'+(i.content||"")+'</div><div class="seentics-modal-actions">'+(i.secondaryButton?'<button class="seentics-btn-secondary" data-seentics-action="'+(i.secondaryAction||(i.secondaryUrl?"secondary":"close"))+'">'+i.secondaryButton+"</button>":"")+'<button class="seentics-btn-primary" data-seentics-action="'+(i.primaryAction||(i.primaryUrl?"primary":"close"))+'">'+(i.primaryButton||"Continue")+"</button></div></div></div></div>",t.body.appendChild(n),n.addEventListener("click",function(t){var o=t.target.closest("[data-seentics-action]");if(o){var a=o.getAttribute("data-seentics-action"),r="primary"===a?i.primaryUrl:i.secondaryUrl;"redirect"!==a&&"primary"!==a&&"secondary"!==a||!r||(e.location.href=r),n.remove()}(t.target.matches("[data-seentics-close]")||t.target.classList.contains("seentics-modal-overlay"))&&n.remove()}),i.customJs)try{new Function("modal",i.customJs)(n)}catch(e){}},f=function(i){l();var n=i.position||"bottom",o=t.createElement("div");o.className="seentics-banner-root",o.innerHTML=i.customHtml||'<div style="position:fixed;'+n+":0;left:0;right:0;background:"+(i.backgroundColor||"#0f172a")+";color:"+(i.textColor||"#fff")+";padding:16px 24px;z-index:2147483646;box-shadow:0 -4px 20px rgba(0,0,0,.1);animation:stSlide"+("top"===n?"Down":"UpBanner")+' .5s cubic-bezier(.16,1,.3,1);display:flex;align-items:center;justify-content:center"><div style="display:flex;align-items:center;gap:16px;max-width:1200px;width:100%;margin:0 auto"><div style="background:rgba(255,255,255,.15);width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">'+(i.icon||"&#10024;")+'</div><div style="flex:1;font-size:15px;font-weight:600;line-height:1.4">'+(i.content||"")+'</div><div style="display:flex;gap:12px;align-items:center">'+(i.primaryButton?'<button data-seentics-action="redirect" style="background:#fff;color:#0f172a;padding:8px 20px;border-radius:8px;font-size:13px;font-weight:700;border:none;cursor:pointer">'+i.primaryButton+"</button>":"")+(!1!==i.closeButton?'<button data-seentics-close style="background:rgba(255,255,255,.1);border:none;color:inherit;width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer">&times;</button>':"")+"</div></div></div>",t.body.appendChild(o),o.addEventListener("click",function(t){t.target.matches("[data-seentics-close]")?o.remove():t.target.closest('[data-seentics-action="redirect"]')&&i.primaryUrl&&(e.location.href=i.primaryUrl)}),i.duration>0&&setTimeout(function(){o.remove()},1e3*i.duration)},u=function(e){l();var i=e.type||"info",n={success:"&#10003;",error:"&#10005;",warning:"!",info:"&#8505;"},o={success:{bg:"#ecfdf5",border:"#10b981",text:"#064e3b",icon:"#10b981"},error:{bg:"#fef2f2",border:"#ef4444",text:"#7f1d1d",icon:"#ef4444"},warning:{bg:"#fffbeb",border:"#f59e0b",text:"#78350f",icon:"#f59e0b"},info:{bg:"#eff6ff",border:"#3b82f6",text:"#1e3a8a",icon:"#3b82f6"}},a=o[i]||o.info,r=t.createElement("div");r.innerHTML='<div style="position:fixed;'+(e.position||"top")+":24px;right:24px;background:"+a.bg+";border:1px solid "+a.border+'40;border-radius:16px;padding:16px;min-width:340px;max-width:420px;box-shadow:0 20px 25px -5px rgba(0,0,0,.1);z-index:2147483645;display:flex;gap:16px;animation:stSlideRight .5s cubic-bezier(.16,1,.3,1)"><div style="background:'+a.icon+';color:#fff;width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0">'+(n[i]||n.info)+'</div><div style="flex:1"><div style="font-size:15px;font-weight:700;color:'+a.text+';margin-bottom:4px">'+(e.title||"Notification")+'</div><div style="font-size:13px;color:'+a.text+'99;line-height:1.5;font-weight:500">'+(e.message||"")+'</div></div><button data-seentics-close style="background:transparent;border:none;font-size:20px;cursor:pointer;color:'+a.text+'40;padding:0;line-height:1;height:fit-content">&times;</button></div>',t.body.appendChild(r),r.addEventListener("click",function(e){e.target.matches("[data-seentics-close]")&&r.remove()}),setTimeout(function(){r.parentNode&&r.remove()},1e3*(e.duration||5))},p=function(){n.initialized||(n.initialized=!0,i.api.get("workflows/site/"+i.config.websiteId+"/active").then(function(e){n.activeAutomations=e.workflows||[],i.emit("automation:loaded",{count:n.activeAutomations.length})}).catch(function(e){i.config.debug&&console.error("[Seentics Automation] Load failed:",e)}).then(function(){!function(){i.on("analytics:pageview",function(e){s("pageview",e)}),i.on("analytics:event",function(e){s("event",e)}),i.on("funnel:dropoff",function(e){s("funneldropoff",e)}),i.on("funnel:complete",function(e){s("funnelcomplete",e)}),i.on("goal:completed",function(e){s("goalcompleted",e)}),t.addEventListener("mouseout",function(e){e.clientY<0&&s("page_exit",{reason:"exit_intent"})}),t.addEventListener("submit",function(e){var t=e.target;s("formsubmit",{formId:t.id,formClass:t.className,formAction:t.action})},!0);var o=null,a=Date.now(),r=function(){a=Date.now(),o&&clearTimeout(o),o=setTimeout(function(){s("inactivity",{seconds:Math.floor((Date.now()-a)/1e3)})},3e4)};if(["mousedown","mousemove","keypress","scroll","touchstart"].forEach(function(e){t.addEventListener(e,i.utils.debounce(r,1e3),{passive:!0})}),r(),n.activeAutomations.some(function(e){return"timeonpage"===(e.triggerType||e.trigger_type||"").toLowerCase()})){var c=0;n.activeAutomations.forEach(function(e){"timeonpage"===(e.triggerType||e.trigger_type||"").toLowerCase()&&(c=Math.max(c,(e.triggerConfig||e.trigger_config||{}).seconds||10))});var l=0,d=setInterval(function(){l++,s("timer",{seconds:l}),l>=c+5&&clearInterval(d)},1e3)}var f=0;e.addEventListener("scroll",i.utils.debounce(function(){var i=t.documentElement.scrollHeight-e.innerHeight;if(!(i<=0)){var n=Math.round(e.scrollY/i*100);n>f&&s("scroll",{depth:f=n})}},500),{passive:!0})}(),JSON.parse(localStorage.getItem("seentics_executed_autos")||"[]").forEach(function(e){n.executedAutomations.add(e)})}))};i.isReady&&i.isReady()?p():i.on("core:ready",p),e.seentics=e.seentics||{},e.seentics.automation={showModal:d,showBanner:f,showNotification:u,trigger:s}}else console.error("[Seentics Automation] Core not loaded.")}(window,document);